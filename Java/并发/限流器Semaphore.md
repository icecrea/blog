# 限流器Semaphore

## 概念
Semaphore信号量模型，是一种通过维护计数器数值来控制并发数量的模型，Lock实现的互斥锁只允许一个线程访问临界区，而Semaphore允许有限多个线程访问临界区。常见于池化资源，连接池、线程池、对象池等。构造时传入初始值表示可以获取锁的线程数。

## 信号量模型
可以简单的概括为：一个计数器、一个等待队列、三个方法。 在信号量模型里，计数器和等待队列对外是透明的，只能通过信号量模型提供的三个方法访问它们，init()、acquire()、release()。

 -  init(): 设置计数器的初始值，初始化凭证数量。
 - acquire()：计数器的值减 1 ；如果此时计数器的值小于 0，则当前线程将被阻塞，放到等待队列之中，否则当前线程可以继续执行。
 - release()：计数器值加 1；如果此时计数器的值小于或者等于 0，则唤醒等待队列中的一个线程，并将其从等待队列中移除。

## 信号量和管程有什么区别？
信号量可以用于限流，同时允许多个线程进入临界区，但不能同时唤醒多个线程起争抢锁，只能唤醒一个阻塞中的线程。并且没有condition概念，阻塞线程唤醒直接运行，不会检查临界条件是否仍满足。也是因为此考虑信号量模型只让一个线程被唤醒，防止线程安全问题。同时信号量实现阻塞队列很麻烦，需要实现condition逻辑。